# Secure software development and web security project

The project was developed by Nathan Furnal and Rehan Duran. The final security
report is called `Report.pdf`.

## Requirements

* [Vagrant](https://www.vagrantup.com/)
* [VirtualBox](https://www.virtualbox.org/) (VMWare or Parallels is also
  acceptable)
* [Composer](https://getcomposer.org/)

The project makes use of [Homestead](https://laravel.com/docs/9.x/homestead)
which is a pre-packaged box for Laravel development. The setup is explained down
below.

## Installing the project

First, clone the repository, using one the following: 

```sh
git clone git@git.esi-bru.be:55803/secg4-second-session.git # for SSH
git clone https://git.esi-bru.be/55803/secg4-second-session.git # for HTTPS
```
Move into the directory with `cd secg4-second-session` and run:

```sh
composer install # installs dependencies
```
Copy the `.env.example` file to `.env` with `cp .env.example .env`. Next, you
will need to create a MySQL database (explained below) and then add the following information to
the `.env` file:

```
DB_DATABASE=homestead
DB_USERNAME=homestead
DB_PASSWORD=secret
```

For encrypting data (Sessions, CSRF tokens and cookies), you need to generate a
key, do so with:
```sh
php artisan key:generate
```
## Setting up Homestead (web server)

Once Vagrant and VirtualBox are installed, you can install Homestead following
those steps (`~` can be replaced by another directory).

```sh
git clone https://github.com/laravel/homestead.git ~/Homestead
```
After cloning,
```sh
cd ~/Homestead
 
git checkout release
```
Then, depending on your distribution OS (inside the Homestead directory).

```sh
# macOS / Linux...
bash init.sh
 
# Windows...
init.bat
```
Now, you can go to folder of this project (`cd secg4-second-session`) and
generate the required `Homestead.yaml` file with:

```sh
php vendor/bin/homestead make
```
The `Homestead.yaml` must be edited, you can use the example down below, which
is the one I am using on my own laptop for this project. You do have to fill the
directory in the folders such that it points to where you installed the project.

If you don't have a SSH key pair already, you will have to generate it with,
RSA has the most support but isn't considered state of the art anymore, [see
here for more information](https://www.ssh.com/academy/ssh/keygen).
```sh
ssh-keygen -t rsa
```
and point Homestead to where the public key can be found (see `authorize`). Note
that to actually see the website, you might need [to setup host name
resolution](https://laravel.com/docs/9.x/homestead#hostname-resolution).

```yaml
ip: 192.168.56.56
memory: 2048
cpus: 2
provider: virtualbox
authorize: ~/.ssh/id_rsa.pub
ssl: true

keys:
    - ~/.ssh/id_rsa
folders:
    -
        map: <YOUR-DIRECTORY>/secg4-seconde-session
        to: /home/vagrant/code
sites:
    -
        map: secg4.test
        to: /home/vagrant/code/public
databases:
    - homestead
features:
    -
        mysql: true
    -
        mariadb: false
    -
        postgresql: false
    -
        ohmyzsh: false
    -
        webdriver: false
services:
    -
        enabled: [mysql]
name: secg4-seconde-session
hostname: secg4-seconde-session
```
## Starting the server

Once all of this is setup (still in the project's directory), you can build the
virtual machine containing the server with `vagrant up`.

Once the box is built, you can SSH into it with `vagrant ssh`. Then, make the
certificate generated by Homestead available to your application, you might have
to create the `storage/app/` folder if it does not already exist.
```sh
# mkdir ~/code/storage/app 
cp /etc/ssl/certs/ca.homestead.secg4-second-session.crt ~/code/storage/app/
```

To use this certificate in the browser (I use Chrome), you have to add it to the
trusted Authorities. This can be found in the Google Chrome settings:
```
Settings > Privacy and Security > Manage certificates > Authorities > Import
```

## Setting up the database

Finally, in the `code` folder (which holds all of your application), you can
run: 

```sh
php artisan migrate
```
which will create the DB and the tables required for the application.

## Usage

Once all the previous steps are done, you can open the browser in which you
modified the authorities and visit the `https://secg4.test` page to start using
the application.

# Advised configuration

This is not strictly necessary but will help for both security and logging
purposes.

## Environment

In the `.env` file, the default behavior at the top of the file is: 
```
APP_NAME=Laravel
APP_ENV=local
APP_KEY=
APP_DEBUG=true
APP_URL=http://localhost
```
This is fine for development purposes but in practice, the debug features should
not be exposed to the end users because they might reveal too much information
about the system (exact versions, possible issues). It is better to use:
```
APP_NAME=Laravel
APP_ENV=production
APP_KEY=# Key generated with php artisan key:generate
APP_DEBUG=false
APP_URL=http://localhost # => replace with the name of the website, should be https://secg4.test
```

## Logging

Laravel does log some of its interactions in `storage/logs/` but it is mostly
about what code is called. For information about GET and POST requests and
overall details about the web server, you have to enable it from within the box.

The web server lives in the virtual box and by default does not log what is
going on. You should go into the box with `vagrant ssh` and then navigate to 
`/etc/nginx/sites-available/`, in there you will find a file with either the
default name `homestead.test` or `secg4.test` depending on the order in which
you followed the instructions.

You then have to modify that file:

```
access_log off; -> access_log /var/log/nginx/secg4-test-access.log;
```
Logging will start once the server (nginx) restarts.
